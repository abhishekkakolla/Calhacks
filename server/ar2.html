<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Mantis</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
</head>
<body>
    <button>Hello</button>
    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: true;"
    >
        <a-camera gps-camera rotation-reader></a-camera>
        
        <!-- Preload the model -->
        <a-assets>
            <a-asset-item id="my-model" src="ipad/gltf.gltf"></a-asset-item>
        </a-assets>

        <!-- Add the model to the scene -->
        <a-entity 
            gltf-model="#my-model"
            position="0 1 -3"
            scale="5 5 5"
            rotation="0 45 0"></a-entity>

        <!-- Camera and light for context -->
        <a-camera position="0 1.6 0"></a-camera>
        <a-light type="ambient" color="#888"></a-light>
    </a-scene>

    <script>
        // Example JSON data
        let jsonData;


        // Function to create text elements from JSON data
        function createTextEntities(data) {
            data.forEach(item => {
                // Create a new a-text element
                const textElement = document.createElement('a-text');
                textElement.setAttribute('value', item.title); // Set the title as the text value
                textElement.setAttribute('look-at', '[gps-camera]'); // Make it face the camera
                textElement.setAttribute('scale', '120 120 120'); // Set scale
                textElement.setAttribute('gps-entity-place', `latitude: ${item.latitude}; longitude: ${item.longitude};`); // Set GPS coordinates

                // Append the new element to the scene
                document.querySelector('a-scene').appendChild(textElement);
            });
        }
        fetch('locations.json')
            .then(response => response.json())
            .then(data => {
                // Store the fetched JSON data in the const jsonData
                jsonData = data;
                
                // Call the function to create text entities
                createTextEntities(jsonData);
            })
            .catch(error => {
                console.error("Error loading JSON data:", error);
            });

        

        // Additional code for GPS functionality remains the same...
        const targetLat = 37.784636;  // Example target latitude
        const targetLong = -122.401419; // Example target longitude
        const distanceThreshold = 30; // Distance threshold in meters to show/hide the text
    
        // Function to handle GPS updates
        function successCallback(position) {
            const userLat = position.coords.latitude;
            const userLong = position.coords.longitude;

            // Calculate the distance...
            const distance = calculateDistance(userLat, userLong, targetLat, targetLong);
            console.log(`Distance: ${distance.toFixed(2)} meters`);
        }

        // Haversine formula remains the same...
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = lat1 * Math.PI/180;
            const φ2 = lat2 * Math.PI/180;
            const Δφ = (lat2 - lat1) * Math.PI/180;
            const Δλ = (lon2 - lon1) * Math.PI/180;

            const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ/2) * Math.sin(Δλ/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c; // Distance in meters
        }

        // Function to handle GPS errors remains the same...
        function errorCallback(error) {
            console.error("Error getting location: ", error);
        }

        // Watch the user's position...
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(successCallback, errorCallback, {
                enableHighAccuracy: true, 
                timeout: 5000,
                maximumAge: 0
            });
        } else {
            console.log("Geolocation is not supported by this browser.");
        }
    </script>
</body>
</html>
